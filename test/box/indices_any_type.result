-- Tests for HASH index type
s3 = box.schema.space.create('my_space4')
---
...
i3_1 = s3:create_index('my_space4_idx1', {type='HASH', parts={1, 'SCALAR', 2, 'INT', 3, 'NUMBER'}, unique=true})
---
...
i3_2 = s3:create_index('my_space4_idx2', {type='HASH', parts={4, 'STR', 5, 'SCALAR'}, unique=true})
---
...
s3:insert({100.5, 30, 95, "str1", 5})
---
- [100.5, 30, 95, 'str1', 5]
...
s3:insert({"abc#$23", 1000, -21.542, "namesurname", 99})
---
- ['abc#$23', 1000, -21.542, 'namesurname', 99]
...
s3:insert({true, -459, 4000, "foobar", "36.6"})
---
- [true, -459, 4000, 'foobar', '36.6']
...
s3:select{}
---
- - [true, -459, 4000, 'foobar', '36.6']
  - ['abc#$23', 1000, -21.542, 'namesurname', 99]
  - [100.5, 30, 95, 'str1', 5]
...
i3_1:select({100.5})
---
- error: Invalid key part count in an exact match (expected 3, got 1)
...
i3_1:select({true, -459})
---
- error: Invalid key part count in an exact match (expected 3, got 2)
...
i3_1:select({"abc#$23", 1000, -21.542})
---
- - ['abc#$23', 1000, -21.542, 'namesurname', 99]
...
i3_2:select({"str1", 5})
---
- - [100.5, 30, 95, 'str1', 5]
...
i3_2:select({"str"})
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
i3_2:select({"str", 5})
---
- []
...
i3_2:select({"foobar", "36.6"})
---
- - [true, -459, 4000, 'foobar', '36.6']
...
s3:drop()
---
...
-- Tests for NULL
mp = require('msgpack')
---
...
s4 = box.schema.space.create('my_space5')
---
...
i4_1 = s4:create_index('my_space5_idx1', {type='HASH', parts={1, 'SCALAR', 2, 'INT', 3, 'NUMBER'}, unique=true})
---
...
i4_2 = s4:create_index('my_space5_idx2', {type='TREE', parts={4, 'SCALAR'}, unique=true})
---
...
s4:insert({mp.NULL, 1, 1, 1})
---
- error: 'Tuple field 1 type does not match one required by operation: expected SCALAR'
...
s4:insert({2, mp.NULL, 2, 2}) -- all nulls must fail
---
- error: 'Tuple field 2 type does not match one required by operation: expected INT'
...
s4:insert({3, 3, mp.NULL, 3})
---
- error: 'Tuple field 3 type does not match one required by operation: expected NUMBER'
...
s4:insert({4, 4, 4, mp.NULL})
---
- error: 'Tuple field 4 type does not match one required by operation: expected SCALAR'
...
s4:drop()
---
...
